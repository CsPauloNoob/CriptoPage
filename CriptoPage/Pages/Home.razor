@page "/"
@using System.Globalization
@using MudBlazor.Utilities

<PageTitle>Calculadora Bitcoin</PageTitle>

<MudPaper Elevation="0"
Class="mt-14 mb-5"
Style="background-color: #111b21; color: #ffffff">
    <MudStack>
        <MudPaper Elevation="0"
        Class="mud-theme-surface"
        Style="background-color: #111b21; color: #ffffff">
            <MudText id="homeP" Align="Align.Center" Typo="Typo.h3">Calcule seus ganhos com Bitcoin</MudText>
        </MudPaper>
        <MudPaper
        Elevation="0"
        Style="background-color: #111b21; color: #ffffff">
            <MudText Align="Align.Center"
            Typo="Typo.h5"
            >faça simulações precisas de compra e
                venda de bitcoin e maximize seus
                lucros com nossa calculadora inteligente
            </MudText>
        </MudPaper>
    </MudStack>


    @* box de dados da Home para telas de Medias e maiores *@
    <MudHidden Invert="true"
    Breakpoint="Breakpoint.SmAndUp">
        <MudStack Row="true"
        Justify="Justify.Center"
        Class="mt-20 d-flex"
        AlignItems="AlignItems.Center">

            @* Box 1 *@
            <MudPaper Style="background-color: #2a3b45;"
            Elevation="3"
            Height="140px"
            Width="40%"
            Class="d-flex flex-column">

                <MudStack Row="true">
                    <MudPaper
                    Elevation="0"
                    Style="background-color: #2a3b45;"
                    Width="100%"
                    Class="mt-5 mx-5 d-flex">

                        <MudIcon
                        Color="Color.Warning"
                        Icon="@Icons.Material.Rounded.CurrencyBitcoin" Size="Size.Medium"/>

                        <MudText Class="ml-2" Style="color:white">Bitcoin</MudText>

                        <MudSpacer/>
                        <MudText Typo="Typo.body1" Style="color: white;">BTC/BRL</MudText>
                    </MudPaper>

                </MudStack>

                <MudPaper
                Elevation="0"
                Style="background-color: #2a3b45;"
                Class="mt-2 mx-5">

                    <MudText Typo="Typo.h4" Style="color: white;">R$ 250.001,00</MudText>

                    <MudPaper Class="d-flex mt-1"
                    Elevation="0"
                    Style="background-color: #2a3b45;">
                        <MudIcon Icon="@Icons.Material.Rounded.ArrowUpward" Color="Color.Success"/>
                        <MudText Typo="Typo.subtitle1" Style="color: white;">2,5%</MudText>
                    </MudPaper>

                </MudPaper>


            </MudPaper>

            @* Box 2 *@
            <MudPaper Style="background-color: #2a3b45;"
            Elevation="3"
            Height="140px"
            Width="40%"
            Class="d-flex flex-column ml-2">

                <MudStack Row="true">
                    <MudPaper
                    Elevation="0"
                    Style="background-color: #2a3b45;"
                    Width="100%"
                    Class="mt-5 mx-5 d-flex">

                        <MudIcon
                        Color="Color.Success"
                        Icon="@Icons.Material.Rounded.CurrencyExchange" Size="Size.Medium"/>

                        <MudText Class="ml-2" Style="color:white">Dólar</MudText>

                        <MudSpacer/>
                        <MudText Typo="Typo.body1" Style="color: white;">USD/BRL</MudText>
                    </MudPaper>

                </MudStack>

                <MudPaper
                Elevation="0"
                Style="background-color: #2a3b45;"
                Class="mt-2 mx-5">

                    <MudText Typo="Typo.h4" Style="color: white;">R$ 5,60</MudText>

                    <MudPaper Class="d-flex mt-1"
                    Elevation="0"
                    Style="background-color: #2a3b45;">
                        <MudIcon Icon="@Icons.Material.Rounded.ArrowDownward" Color="Color.Error"/>
                        <MudText Typo="Typo.subtitle1" Style="color: white;">2,5%</MudText>
                    </MudPaper>

                </MudPaper>
            </MudPaper>
        </MudStack>
    </MudHidden>


    @* Boxes Inicial para telas pequenas *@
    <MudHidden Invert="true"
    Breakpoint="Breakpoint.Xs">
        <MudStack
        Justify="Justify.Center"
        Class="mt-20 d-flex"
        AlignItems="AlignItems.Center">

            @* Box 1 *@
            <MudPaper Style="background-color: #2a3b45;"
            Elevation="3"
            Height="140px"
            Width="70%"
            Class="d-flex flex-column">

                <MudStack Row="true">
                    <MudPaper
                    Elevation="0"
                    Style="background-color: #2a3b45;"
                    Width="100%"
                    Class="mt-5 mx-5 d-flex">

                        <MudIcon
                        Color="Color.Warning"
                        Icon="@Icons.Material.Rounded.CurrencyBitcoin" Size="Size.Medium"/>

                        <MudText Class="ml-2" Style="color:white">Bitcoin</MudText>

                        <MudSpacer/>
                        <MudText Typo="Typo.body1" Style="color: white;">BTC/BRL</MudText>
                    </MudPaper>

                </MudStack>

                <MudPaper
                Elevation="0"
                Style="background-color: #2a3b45;"
                Class="mt-2 mx-5">

                    <MudText Typo="Typo.h5" Style="color: white;">R$ 250.010,32</MudText>

                    <MudPaper Class="d-flex mt-1"
                    Elevation="0"
                    Style="background-color: #2a3b45; flex-wrap: wrap;">
                        <MudIcon Icon="@Icons.Material.Rounded.ArrowUpward" Color="Color.Success"/>
                        <MudText Typo="Typo.subtitle1" Style="color: white;">2,5%</MudText>
                    </MudPaper>

                </MudPaper>


            </MudPaper>

            @* Box 2 *@
            <MudPaper Style="background-color: #2a3b45;"
            Elevation="3"
            Width="70%"
            Class="d-flex flex-column mt-1">

                <MudStack Row="true">
                    <MudPaper
                    Elevation="0"
                    Style="background-color: #2a3b45;"
                    Width="100%"
                    Class="mt-5 mx-5 d-flex">

                        <MudIcon
                        Color="Color.Success"
                        Icon="@Icons.Material.Rounded.CurrencyExchange" Size="Size.Medium"/>

                        <MudText Class="ml-2" Style="color:white">Dólar</MudText>

                        <MudSpacer/>
                        <MudText Typo="Typo.body1" Style="color: white;">USD/BRL</MudText>
                    </MudPaper>

                </MudStack>

                <MudPaper
                Elevation="0"
                Style="background-color: #2a3b45;"
                Class="mt-2 mx-5">

                    <MudText Typo="Typo.h5" Style="color: white;">R$ 5,60</MudText>

                    <MudPaper Class="d-flex mt-1"
                    Elevation="0"
                    Style="background-color: #2a3b45;">
                        <MudIcon Icon="@Icons.Material.Rounded.ArrowDownward" Color="Color.Error"/>
                        <MudText Typo="Typo.subtitle1" Style="color: white;">2,5%</MudText>
                    </MudPaper>

                </MudPaper>
            </MudPaper>
        </MudStack>
    </MudHidden>


    @* Input de calculo de histórico de investimento Para telas tablet e maiores*@
    <MudHidden Invert="true"
               Breakpoint="Breakpoint.SmAndUp">
        <MudStack Justify="Justify.Center" Row="true">

            <MudPaper Elevation="5"
                      Style="background-color: #2a3b45; color: white; width: 81%"
                      Class="mt-10 pb-10 d-flex align-self-center flex-grow gap-4 mb-12">

                @* Inputs *@
                <MudPaper
                    Class="ml-3 mr-n8"
                    Elevation="0"
                    Width="47%"
                    Style="background-color: #2a3b45; color: white;">

                    @* Titulo *@
                    <MudPaper
                        Elevation="0"
                        Class="mb-5 mt-8 align-self-center"
                        Style="background-color: #2a3b45; color: white;">

                        <MudText Typo="Typo.h5">Simulador de Investimentos</MudText>

                    </MudPaper>

                    <MudForm Spacing="12">

                        <MudDatePicker
                            Style="background: white;"
                            Color="Color.Primary"
                            Label="Data da Compra"
                            Editable="true"
                            Mask="@(new DateMask("dd/MM/yyyy"))"
                            DateFormat="dd/MM/yyyy"
                            Placeholder="dd/mm/yyyy"
                            Variant="Variant.Filled"/>

                        <MudDatePicker
                            Style="background: white;"
                            Color="Color.Primary"
                            Label="Data da Venda"
                            Editable="true"
                            Mask="@(new DateMask("dd/MM/yyyy"))"
                            DateFormat="dd/MM/yyyy"
                            Placeholder="dd/mm/yyyy"
                            Variant="Variant.Filled"/>

                        <MudPaper Elevation="0"
                                  Style="background-color: #2a3b45; color:white;"
                                  Class="d-flex">
                            <MudTextField
                                @bind-Value="Result_ValorInicial"
                                Label="Total investido"
                                InputMode="InputMode.numeric"
                                Variant="Variant.Filled"
                                Placeholder="Ex: R$ 1000"
                                Style="background: white; width:70%"
                                Adornment="Adornment.Start"
                                AdornmentIcon="@Icons.Material.Filled.AttachMoney"
                                AdornmentText="@(IsBRL ? "R$" : "US$")"
                                Culture="@(new CultureInfo("pt-BR"))"/>

                            <MudText Class="pt-2" Align="Align.Center">USD</MudText>
                            <MudSwitch Label="BRL"
                                       UncheckedColor="Color.Warning"
                                       Color="Color.Success"
                                       Size="Size.Medium"
                                       T="bool"
                                       @bind-Value="IsBRL"/>
                        </MudPaper>

                        <MudButton
                            OnClick="CalcularGanhos"
                            Size="Size.Medium"
                            Variant="Variant.Filled"
                            Style="background-color: darkgoldenrod; color: black">Calcular Ganhos
                        </MudButton>
                    </MudForm>

                </MudPaper>

                @* Tela de Resultados *@
                <MudPaper Elevation="5"
                          Class="ml-13 mr-5 mt-8"
                          Style="background-color: #2a3b45; color: white;"
                          Width="50%">

                    <MudPaper
                        Elevation="0"
                        Class="ml-3 mb-5 align-self-center"
                        Style="background-color: inherit; color: white;">

                        <MudText Typo="Typo.h5">Resultado da Simulação</MudText>

                        <MudPaper Elevation="0"
                                  Class="ml-3"
                                  Style="background-color: inherit">

                            <MudStack
                                Spacing="5"
                                Style="color: white" Class="mr-3 mt-8">
                                <MudTextField
                                    @bind-Value="ResultVI"
                                    Style="background-color: white"
                                    Variant="Variant.Filled"
                                    Label="Valor Inicial"
                                    ShrinkLabel="true"
                                    ReadOnly="true"/>

                                <MudTextField
                                    Value="ResultVF"
                                    Style="background-color: white"
                                    Variant="Variant.Filled"
                                    AdornmentColor="Color.Dark"
                                    Label="Valor Final"
                                    ShrinkLabel="true"
                                    ReadOnly="true"
                                    T="string"/>

                                <MudTextField
                                    Variant="Variant.Filled"
                                    Style="@($"background-color: white; color: {color};")"
                                    Label="Lucro/Prejuízo"
                                    Value="DiferenceResult"
                                    ShrinkLabel="true"
                                    ReadOnly="true"
                                    T="string"/>
                                
                                <MudTextField
                                    Variant="Variant.Filled"
                                    Style="@($"background-color: white; color: {color};")"
                                    Label="Rentabilidade"
                                    Value="Rentabilidade"
                                    ShrinkLabel="true"
                                    ReadOnly="true"
                                    T="string"/>
                                
                                <MudText Class="mb-n2">Variação no Período</MudText>
                                
                                <MudProgressLinear
                                    Style="background-color: white; height: 24px;"
                                    Rounded="true"
                                    Color="ProgressColor"
                                    Size="Size.Large"
                                    Value="(double)Percent_LucroPrej">
                                    <MudText
                                        Typo="Typo.subtitle1"
                                        Color="Color.Dark">
                                        
                                        @Percent_LucroPrej.ToString("N2")%
                                        
                                    </MudText>
                                    
                                </MudProgressLinear>
                            </MudStack>

                        </MudPaper>

                    </MudPaper>


                </MudPaper>

            </MudPaper>

        </MudStack>

    </MudHidden>
    
    @* Input de calculo de histórico de investimento Para telas pequenas *@
    <MudHidden Invert="true"
               Breakpoint="Breakpoint.Xs">
        <MudStack Justify="Justify.Center">

            <MudPaper Elevation="5"
                      Style="background-color: #2a3b45; color: white; width: 100%"
                      Class="mt-10 pb-10 align-self-center flex-grow gap-4 mb-12">

                @* Inputs *@
                <MudPaper Class="ml-3"
                          Elevation="0"
                          Width="90%"
                          Style="background-color: #2a3b45; color: white;">

                    @* Titulo *@
                    <MudPaper Elevation="0"
                              Width="100%"
                              Class="mb-5 mt-8 align-self-center"
                              Style="background-color: #2a3b45; color: white;">

                        <MudText Typo="Typo.h5">Simulador de Investimentos</MudText>

                    </MudPaper>

                    <MudForm Spacing="12">

                        <MudDatePicker Style="background: white;"
                                       Color="Color.Primary"
                                       Label="Data da Compra"
                                       Editable="true"
                                       Mask="@(new DateMask("dd/MM/yyyy"))"
                                       DateFormat="dd/MM/yyyy"
                                       Placeholder="dd/mm/yyyy"
                                       Variant="Variant.Filled" />

                        <MudDatePicker Style="background: white;"
                                       Color="Color.Primary"
                                       Label="Data da Venda"
                                       Editable="true"
                                       Mask="@(new DateMask("dd/MM/yyyy"))"
                                       DateFormat="dd/MM/yyyy"
                                       Placeholder="dd/mm/yyyy"
                                       Variant="Variant.Filled" />

                        <MudPaper Elevation="0" Width="100%"
                                  Style="background-color: #2a3b45; color:white;"
                                  Class="d-flex">
                            <MudTextField @bind-Value="Result_ValorInicial"
                                          Label="Total investido"
                                          InputMode="InputMode.numeric"
                                          Variant="Variant.Filled"
                                          Placeholder="Ex: R$ 1000"
                                          Style="background: white; width:70%"
                                          Adornment="Adornment.Start"
                                          AdornmentIcon="@Icons.Material.Filled.AttachMoney"
                                          AdornmentText="@(IsBRL ? "R$" : "US$")"
                                          Culture="@(new CultureInfo("pt-BR"))" />

                            <MudText Class="pt-2" Align="Align.Center">USD</MudText>
                            <MudSwitch Label="BRL"
                                       UncheckedColor="Color.Warning"
                                       Color="Color.Success"
                                       Size="Size.Medium"
                                       T="bool"
                                       @bind-Value="IsBRL" />
                        </MudPaper>

                        <MudButton OnClick="CalcularGanhos"
                                   Size="Size.Medium"
                                   Variant="Variant.Filled"
                                   Style="background-color: darkgoldenrod; color: black">
                            Calcular Ganhos
                        </MudButton>
                    </MudForm>

                </MudPaper>

                @* Tela de Resultados *@
                <MudPaper Elevation="5"
                          Class="ml-3 mr-5 mt-8"
                          Style="background-color: #2a3b45; color: white;"
                          Width="90%">

                    <MudPaper Elevation="0"
                              Class="ml-3 mb-5 align-self-center"
                              Style="background-color: inherit; color: white;">

                        <MudText Typo="Typo.h5">Resultado da Simulação</MudText>

                        <MudPaper Elevation="0"
                                  Class="ml-3"
                                  Style="background-color: inherit">

                            <MudStack Spacing="5"
                                      Style="color: white" Class="mr-3 mt-8">
                                <MudTextField @bind-Value="ResultVI"
                                              Style="background-color: white"
                                              Variant="Variant.Filled"
                                              Label="Valor Inicial"
                                              ShrinkLabel="true"
                                              ReadOnly="true" />

                                <MudTextField Value="ResultVF"
                                              Style="background-color: white"
                                              Variant="Variant.Filled"
                                              AdornmentColor="Color.Dark"
                                              Label="Valor Final"
                                              ShrinkLabel="true"
                                              ReadOnly="true"
                                              T="string" />

                                <MudTextField Variant="Variant.Filled"
                                              Style="@($"background-color: white; color: {color};")"
                                              Label="Lucro/Prejuízo"
                                              Value="DiferenceResult"
                                              ShrinkLabel="true"
                                              ReadOnly="true"
                                              T="string" />

                                <MudTextField Variant="Variant.Filled"
                                              Style="@($"background-color: white; color: {color};")"
                                              Label="Rentabilidade"
                                              Value="Rentabilidade"
                                              ShrinkLabel="true"
                                              ReadOnly="true"
                                              T="string" />

                                <MudText Class="mb-n2">Variação no Período</MudText>

                                <MudProgressLinear Style="background-color: white; height: 24px;"
                                                   Rounded="true"
                                                   Color="ProgressColor"
                                                   Size="Size.Large"
                                                   Value="(double)Percent_LucroPrej">
                                    <MudText Typo="Typo.subtitle1"
                                             Color="Color.Dark">

                                        @Percent_LucroPrej.ToString("N2")%

                                    </MudText>

                                </MudProgressLinear>
                            </MudStack>

                        </MudPaper>

                    </MudPaper>


                </MudPaper>

            </MudPaper>

        </MudStack>

    </MudHidden>

    @* Sessão de contato *@
    <MudPaper Class="mt-20 py-20 justify-center" Style="background-color: #2a3b45; color:  white; justify-content: center; text-align: center;">
        <MudText Align="Align.Center" Typo="Typo.h4">Precisa de Ajuda com seus investimentos?</MudText>
        
        <MudPaper Class="mx-16 mt-4" 
                  Elevation="0"
                  Style="background-color: #2a3b45; 
                  color:  white;">
            <MudText Align="Align.Center">Fale com nossos especialistas via WhatsApp e receba orientações personalizadas</MudText>
        </MudPaper>
        
        <MudButton Class="mt-10"
            StartIcon="@Icons.Custom.Brands.WhatsApp"
            Variant="Variant.Filled"
            Style="background-color: #25D366; color: white; margin: 0 auto;">
            Conversar no WhatsApp
        </MudButton>
    </MudPaper>

</MudPaper>

@code
{

    bool IsBRL { get; set; } = true;

    double Result_ValorInicial;
    double Result_ValorFinal;
    string DiferenceResult = string.Empty;
    string Rentabilidade = string.Empty;

    int _random;

    string ResultVI = string.Empty;
    string ResultVF = string.Empty;

    Color ProgressColor = Color.Primary;
    MudColor color = new PaletteLight().Error; //Para Txts de moeda e lucro ou prejuizo. 
    string ActualCurrency;

    string[] Currency = new string[] { "USDT", "BRL" };

    decimal Percent_LucroPrej;

    async Task CalcularGanhos()
    {
        var vf = new Random().Next(100, 120); //Simulação lucro/prejuízo
        _random = _random;
        ParseResults();

        if (vf > 0 && vf < Result_ValorInicial)
        {
            DiferenceResult = (vf - Result_ValorInicial).ToString("N2");
            Result_ValorFinal = vf;
            color = new PaletteLight().Error;
        }

        else if (vf > 0 && vf > Result_ValorInicial)
        {
            DiferenceResult = (vf - Result_ValorInicial).ToString("N2");
            Result_ValorFinal = vf;
            color = new PaletteLight().Success;
        }

        if (Result_ValorFinal <= 0)
            Result_ValorFinal = 0;

        else
        {
            AjustarMoedas();
            CalcularPorcentagem();   
        }

    }

    void CalcularPorcentagem()
    {
        if (Result_ValorInicial == 0)
        {
            Percent_LucroPrej = 0;
            ProgressColor = Color.Primary;
        }
        else
        {
            Percent_LucroPrej = (Decimal)((Result_ValorFinal - Result_ValorInicial) / Result_ValorInicial) * 100; 
        }

        if (Percent_LucroPrej > 0)
        {
            Rentabilidade = $"+{Percent_LucroPrej:N2}%";
            ProgressColor = Color.Success;
        }
        else
        {
            Rentabilidade = $"{Percent_LucroPrej:N2}%";
            ProgressColor = Color.Error;
        }
    }

    void AjustarMoedas()
    {
        ActualCurrency = IsBRL ? "R$ " : "US$ ";

        ResultVF = ActualCurrency + Result_ValorFinal.ToString();
        ResultVI = ActualCurrency + Result_ValorInicial.ToString();
        DiferenceResult = ActualCurrency + DiferenceResult;
    }

    void ParseResults()
    {
        // if (!double.TryParse(ResultVI, out Result_ValorInicial))
        // {
        //     ResultVI = "Valor inicial inválido";
        // }

        if (!double.TryParse(ResultVF, out Result_ValorFinal))
        {
            ResultVF = "Valor final inválido";
        }
    }
}